#!/usr/bin/env bash

if [ -z "$NGROK_API_TOKEN" ];then echo "You must set the NGROK_API_TOKEN config var to create a TCP tunnel!";exit 1;fi

DIR="$(cd "$(dirname "$(readlink -f "$0")")" && pwd)"
npm i --prefix $DIR

echo "Starting: The Reverse Proxy"
$DIR/proxy.js &
tunnel_pid=$!
sleep 5

echo "Starting: The Server At Port 22023..."
$DIR/Server/Impostor.Server &
main_pid=$!
sleep 2

trap "kill $tunnel_pid $main_pid" SIGTERM
trap "kill -9 $tunnel_pid $main_pid; exit" SIGKILL
